services:
  server:
    build:
      context: ../..
      dockerfile: apps/server/Dockerfile
    env_file:
      - ../../apps/server/.env
    command: sh -lc "corepack enable && pnpm install && pnpm start:dev"
    volumes:
      - ../../apps/server:/app
      - /app/node_modules
    ports:
      - "4000:4000"
    depends_on:
      mongo:
        condition: service_healthy
      redis:
        condition: service_healthy
    networks: [app-net]

  web:
    build:
      context: ../..
      dockerfile: apps/web/Dockerfile
    command: sh -lc "corepack enable && pnpm install && pnpm dev --host 0.0.0.0"
    volumes:
      - ../../apps/web:/app
      - /app/node_modules
    ports:
      - "3001:3000"
    depends_on:
      - server
    networks: [app-net]
